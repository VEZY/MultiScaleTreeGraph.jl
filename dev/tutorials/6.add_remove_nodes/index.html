<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Add/remove nodes · MultiScaleTreeGraph.jl</title><meta name="title" content="Add/remove nodes · MultiScaleTreeGraph.jl"/><meta property="og:title" content="Add/remove nodes · MultiScaleTreeGraph.jl"/><meta property="twitter:title" content="Add/remove nodes · MultiScaleTreeGraph.jl"/><meta name="description" content="Documentation for MultiScaleTreeGraph.jl."/><meta property="og:description" content="Documentation for MultiScaleTreeGraph.jl."/><meta property="twitter:description" content="Documentation for MultiScaleTreeGraph.jl."/><meta property="og:url" content="https://VEZY.github.io/MultiScaleTreeGraph.jl/tutorials/6.add_remove_nodes/"/><meta property="twitter:url" content="https://VEZY.github.io/MultiScaleTreeGraph.jl/tutorials/6.add_remove_nodes/"/><link rel="canonical" href="https://VEZY.github.io/MultiScaleTreeGraph.jl/tutorials/6.add_remove_nodes/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MultiScaleTreeGraph.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../get_started/">Getting started</a></li><li><span class="tocitem">The MTG format</span><ul><li><a class="tocitem" href="../../the_mtg/mtg_concept/">Concept</a></li><li><a class="tocitem" href="../../the_mtg/mtg_format/">File format</a></li><li><a class="tocitem" href="../../the_mtg/our_implementation/">Our implementation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../0.read_write/">Read and Write MTGs</a></li><li><a class="tocitem" href="../1.manipulate_node/">Accessing node data</a></li><li><a class="tocitem" href="../2.descendants_ancestors_filters/">Node attributes</a></li><li><a class="tocitem" href="../3.transform_mtg/">Transform an MTG</a></li><li><a class="tocitem" href="../4.convert_mtg/">Converting MTGs</a></li><li><a class="tocitem" href="../5.plotting/">Plotting</a></li><li class="is-active"><a class="tocitem" href>Add/remove nodes</a><ul class="internal"><li><a class="tocitem" href="#Make-an-MTG-manually"><span>Make an MTG manually</span></a></li><li><a class="tocitem" href="#Insert/remove-nodes-programmatically"><span>Insert/remove nodes programmatically</span></a></li><li><a class="tocitem" href="#Delete-nodes"><span>Delete nodes</span></a></li><li><a class="tocitem" href="#Insert-nodes"><span>Insert nodes</span></a></li></ul></li><li><a class="tocitem" href="../7.performance_considerations/">Performance Considerations</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Add/remove nodes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Add/remove nodes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VEZY/MultiScaleTreeGraph.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VEZY/MultiScaleTreeGraph.jl/blob/master/docs/src/tutorials/6.add_remove_nodes.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Add/remove-nodes"><a class="docs-heading-anchor" href="#Add/remove-nodes">Add/remove nodes</a><a id="Add/remove-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Add/remove-nodes" title="Permalink"></a></h1><h2 id="Make-an-MTG-manually"><a class="docs-heading-anchor" href="#Make-an-MTG-manually">Make an MTG manually</a><a id="Make-an-MTG-manually-1"></a><a class="docs-heading-anchor-permalink" href="#Make-an-MTG-manually" title="Permalink"></a></h2><p>It is very easy to add or remove nodes in an MTG. Actually, we can even construct an MTG completely manually.</p><h3 id="Root-node"><a class="docs-heading-anchor" href="#Root-node">Root node</a><a id="Root-node-1"></a><a class="docs-heading-anchor-permalink" href="#Root-node" title="Permalink"></a></h3><p>Create the root node:</p><pre><code class="language-julia hljs">mtg = Node(MutableNodeMTG(&quot;/&quot;, &quot;Plant&quot;, 0, 1), Dict{Symbol,Any}(:species =&gt; &quot;Grassy-plant&quot;))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
</code></pre><p>The first argument to <a href="../../api/#MultiScaleTreeGraph.Node"><code>Node</code></a> is its MTG description: link with parent, scale, index, and symbol. It is given as a <a href="../../api/#MultiScaleTreeGraph.MutableNodeMTG"><code>MutableNodeMTG</code></a> (or a <a href="../../api/#MultiScaleTreeGraph.NodeMTG"><code>NodeMTG</code></a>). The second argument contains node attributes.</p><h3 id="Node-id"><a class="docs-heading-anchor" href="#Node-id">Node id</a><a id="Node-id-1"></a><a class="docs-heading-anchor-permalink" href="#Node-id" title="Permalink"></a></h3><p>The ids of the nodes should be unique. They are automatically computed using <a href="../../api/#MultiScaleTreeGraph.new_id-Tuple{Int64}"><code>new_id</code></a> starting by 1 at the root node:</p><pre><code class="language-julia hljs">new_id(mtg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2</code></pre><h3 id="Adding-new-nodes"><a class="docs-heading-anchor" href="#Adding-new-nodes">Adding new nodes</a><a id="Adding-new-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-new-nodes" title="Permalink"></a></h3><p>To create a child node, we use a different method of <a href="../../api/#MultiScaleTreeGraph.Node"><code>Node</code></a>. This method is close to the one we used for the root, except there is a new argument at the first position: the parent node. Here we use the root node as the parent (<code>mtg</code>):</p><pre><code class="language-julia hljs">IN1 = Node(mtg, MutableNodeMTG(&quot;/&quot;, &quot;Internode&quot;, 0, 2), Dict{Symbol,Any}(:diameter =&gt; 0.1, :length =&gt; 0.5))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 2: Internode
</code></pre><p>Now the MTG has two nodes:</p><pre><code class="language-julia hljs">mtg</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
</code></pre><p>We can continue like this indefinitely. For example we can add a leaf to the first internode:</p><pre><code class="language-julia hljs">Node(IN1, MutableNodeMTG(&quot;+&quot;, &quot;Leaf&quot;, 0, 2), Dict{Symbol,Any}(:area =&gt; 0.2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">+ 3: Leaf
</code></pre><div class="admonition is-info" id="Note-e572b7cd1815b235"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-e572b7cd1815b235" title="Permalink"></a></header><div class="admonition-body"><p>If a node has no children, there is no need to keep track of it in an object.</p></div></div><p>And an internode following the first internode:</p><pre><code class="language-julia hljs">IN2 = Node(IN1, MutableNodeMTG(&quot;&lt;&quot;, &quot;Internode&quot;, 1, 2), Dict{Symbol,Any}(:diameter =&gt; 0.15, :length =&gt; 0.3))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt; 4: Internode
</code></pre><p>And a leaf to it:</p><pre><code class="language-julia hljs">Node(IN2, MutableNodeMTG(&quot;+&quot;, &quot;Leaf&quot;, 1, 2), Dict{Symbol,Any}(:area =&gt; 0.2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">+ 5: Leaf
</code></pre><p>And here is our resulting MTG:</p><pre><code class="language-julia hljs">mtg</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ + 3: Leaf
   └─ &lt; 4: Internode
      └─ + 5: Leaf
</code></pre><p>And the attributes:</p><pre><code class="language-julia hljs">DataFrame(mtg, get_attributes(mtg))</code></pre><div><div style = "float: left;"><span>5×11 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">tree</th><th style = "text-align: left;">id</th><th style = "text-align: left;">symbol</th><th style = "text-align: left;">scale</th><th style = "text-align: left;">index</th><th style = "text-align: left;">parent_id</th><th style = "text-align: left;">link</th><th style = "text-align: left;">species</th><th style = "text-align: left;">diameter</th><th style = "text-align: left;">area</th><th style = "text-align: left;">length</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Union{Missing, String}" style = "text-align: left;">String?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Symbol}" style = "text-align: left;">Symbol?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Symbol}" style = "text-align: left;">Symbol?</th><th title = "Union{Missing, String}" style = "text-align: left;">String?</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">/ 1: Plant</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Plant</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "text-align: left;">/</td><td style = "text-align: left;">Grassy-plant</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">└─ / 2: Internode</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: left;">/</td><td style = "font-style: italic; text-align: left;">missing</td><td style = "text-align: right;">0.1</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "text-align: right;">0.5</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">   ├─ + 3: Leaf</td><td style = "text-align: right;">3</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">2</td><td style = "text-align: left;">+</td><td style = "font-style: italic; text-align: left;">missing</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "text-align: right;">0.2</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">   └─ &lt; 4: Internode</td><td style = "text-align: right;">4</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">2</td><td style = "text-align: left;">&lt;</td><td style = "font-style: italic; text-align: left;">missing</td><td style = "text-align: right;">0.15</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "text-align: right;">0.3</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">      └─ + 5: Leaf</td><td style = "text-align: right;">5</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">4</td><td style = "text-align: left;">+</td><td style = "font-style: italic; text-align: left;">missing</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "text-align: right;">0.2</td><td style = "font-style: italic; text-align: right;">missing</td></tr></tbody></table></div><h3 id="Inserting-nodes"><a class="docs-heading-anchor" href="#Inserting-nodes">Inserting nodes</a><a id="Inserting-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Inserting-nodes" title="Permalink"></a></h3><h4 id="Insertion-functions"><a class="docs-heading-anchor" href="#Insertion-functions">Insertion functions</a><a id="Insertion-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Insertion-functions" title="Permalink"></a></h4><p>Adding nodes step by step is easy, but sometimes we want to insert nodes in-between other nodes. We can still use <code>Node</code> to do so, but it becomes a bit cumbersome because you&#39;ll have to handle manually the changes in parents, children and siblings.</p><p>We provide some helper functions that does it for you instead:</p><ul><li><a href="../../api/#MultiScaleTreeGraph.insert_parent!"><code>insert_parent!</code></a>: add a new parent node</li><li><a href="../../api/#MultiScaleTreeGraph.insert_child!"><code>insert_child!</code></a>: add a new child node</li><li><a href="../../api/#MultiScaleTreeGraph.insert_sibling!"><code>insert_sibling!</code></a>: add a new sibling node</li><li><a href="../../api/#MultiScaleTreeGraph.insert_generation!"><code>insert_generation!</code></a>: add a new child node, but this new child is considered a whole new generation, meaning the previous children of the node become the children of the new node.</li></ul><div class="admonition is-warning" id="Warning-9210a242b4a42455"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-9210a242b4a42455" title="Permalink"></a></header><div class="admonition-body"><p>Note the singular form for the name of the functions. The plural form does the job on the whole MTG for selected nodes (see <a href="#Insert-nodes-at-position">Insert nodes at position</a>).</p></div></div><h4 id="The-NodeMTG"><a class="docs-heading-anchor" href="#The-NodeMTG">The NodeMTG</a><a id="The-NodeMTG-1"></a><a class="docs-heading-anchor-permalink" href="#The-NodeMTG" title="Permalink"></a></h4><p>Those functions use a <code>NodeMTG</code> (or <code>MutableNodeMTG</code>), and automatically:</p><ul><li>find a unique id for the node</li><li>add its children, parents and siblings</li><li>update the links of the parents / siblings / children</li></ul><pre><code class="language-julia hljs">mtg_2 = deepcopy(mtg)

insert_parent!(mtg_2, NodeMTG(:/, :Scene, 0, 0))

mtg_2 = get_root(mtg_2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 6: Scene
└─ / 1: Plant
   └─ / 2: Internode
      ├─ + 3: Leaf
      └─ &lt; 4: Internode
         └─ + 5: Leaf
</code></pre><p>The <code>NodeMTG</code> can also be computed based on the node on which we insert the new node. In this case we can pass a function that take the node as input and returns the template for us:</p><pre><code class="language-julia hljs">mtg_2 = deepcopy(mtg)

insert_parent!(
    mtg_2,
    node -&gt; (
        link = link(node),
        symbol = :Scene,
        index = index(node),
        scale = scale(node) - 1
    )
)
mtg_2 = get_root(mtg_2)

node_mtg(mtg_2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MutableNodeMTG(:/, :Scene, 0, 0)</code></pre><p>The MTG encoding field of the newly-created root node (<code>node_mtg(mtg_2)</code>) used some of the information from the MTG to compute its values.</p><div class="admonition is-info" id="Note-22e2f35909e408ac"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-22e2f35909e408ac" title="Permalink"></a></header><div class="admonition-body"><p>We use <a href="../../api/#MultiScaleTreeGraph.get_root-Tuple{Node}"><code>get_root</code></a> to recompute <code>mtg_2</code> because <a href="../../api/#MultiScaleTreeGraph.insert_parent!"><code>insert_parent!</code></a> always return the input node, which is not the root node of the MTG anymore.</p></div></div><h4 id="Node-attributes"><a class="docs-heading-anchor" href="#Node-attributes">Node attributes</a><a id="Node-attributes-1"></a><a class="docs-heading-anchor-permalink" href="#Node-attributes" title="Permalink"></a></h4><p>We can also provide attributes for the new node using the <code>attr_fun</code> argument. <code>attr_fun</code> expects a function that computes new attributes based on the input node. This function must return attribute values of the same type as the one used for other nodes attributes in the MTG (<em>e.g.</em> <code>Dict</code> or <code>NamedTuple</code>).</p><p>To know what is the type used for the attributes of your MTG, you can use <code>typeof</code> as follows:</p><pre><code class="language-julia hljs">typeof(node_attributes(mtg))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiScaleTreeGraph.ColumnarAttrs</code></pre><p>If you just need to pass attributes values to a node, you can do as follows:</p><pre><code class="language-julia hljs">mtg_2 = deepcopy(mtg)

insert_child!(
    mtg_2,
    NodeMTG(:/, :Axis, 0, 2),
    node -&gt; Dict{Symbol, Any}(:length =&gt; 2, :area =&gt;  0.1)
)

node_attributes(mtg_2[1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiScaleTreeGraph.ColumnarAttrs with 2 entries:
  :diameter =&gt; 0.1
  :length   =&gt; 0.5</code></pre><p>But we can also compute our attributes based on other nodes data:</p><pre><code class="language-julia hljs">mtg_2 = deepcopy(mtg)

insert_child!(
    mtg_2,
    NodeMTG(:/, :Axis, 0, 2),
    node -&gt; Dict{Symbol, Any}(:total_length =&gt; sum(descendants(node, :length, ignore_nothing = true)))
)

node_attributes(mtg_2[1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiScaleTreeGraph.ColumnarAttrs with 2 entries:
  :diameter =&gt; 0.1
  :length   =&gt; 0.5</code></pre><p>We use <code>mtg_2[1]</code> here to get the first child of the root node.</p><h3 id="Delete-a-node"><a class="docs-heading-anchor" href="#Delete-a-node">Delete a node</a><a id="Delete-a-node-1"></a><a class="docs-heading-anchor-permalink" href="#Delete-a-node" title="Permalink"></a></h3><p>It is possible to remove a single node in an MTG using <a href="../../api/#MultiScaleTreeGraph.delete_node!-Union{Tuple{Node{N, A}}, Tuple{A}, Tuple{N}} where {N&lt;:AbstractNodeMTG, A}"><code>delete_node!</code></a>. For example if we want to delete the second internode (node 4):</p><pre><code class="language-julia hljs">mtg_del = deepcopy(mtg)

delete_node!(get_node(mtg_del, 4))

mtg_del</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ + 3: Leaf
   └─ + 5: Leaf
</code></pre><p>As we can see the new MTG has only one internode now, and the children of the second internode are now the children of its parents, the first internode.</p><p>But what if we deleted the first internode?</p><pre><code class="language-julia hljs">mtg_del = deepcopy(mtg)

delete_node!(get_node(mtg_del, 2))

mtg_del</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
├─ + 3: Leaf
└─ / 4: Internode
   └─ + 5: Leaf
</code></pre><p>We don&#39;t see it here in the documentation but this expressions returns a warning now. It says:</p><blockquote><p>Warning: Scale of the child node branched but its deleted parent was decomposing. Keep branching, please check if the decomposition is still correct.</p></blockquote><p>This is because we don&#39;t really know what should be the new link for a branching child replacing a decomposing node. So by default we don&#39;t make any assumption and keep the scale of the child as it is, in the hope the user will look into it.</p><p>In our example the first leaf is now branching from the plant, while it should decompose it because it is not of the same scale. But a leaf decomposing a Plant has no meaning botanically. The best approach would be to keep an intermediary node, as it was before.</p><p>The user can define its own rules for the new links using the <code>child_link_fun</code> keyword argument of <a href="../../api/#MultiScaleTreeGraph.delete_node!-Union{Tuple{Node{N, A}}, Tuple{A}, Tuple{N}} where {N&lt;:AbstractNodeMTG, A}"><code>delete_node!</code></a> (click to see an example usage). It expect a function that takes the child node as input and return its new link.</p><p>For example one could decide to never replace the children link and manage them afterward. In this case we can use the identity function like this:</p><pre><code class="language-julia hljs">mtg_del = deepcopy(mtg)

delete_node!(get_node(mtg_del, 2), child_link_fun = link)

mtg_del</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
├─ + 3: Leaf
└─ &lt; 4: Internode
   └─ + 5: Leaf
</code></pre><p>It didn&#39;t change anything here because the child already kept its own link. But it will differ for other types of parent / children links.</p><h2 id="Insert/remove-nodes-programmatically"><a class="docs-heading-anchor" href="#Insert/remove-nodes-programmatically">Insert/remove nodes programmatically</a><a id="Insert/remove-nodes-programmatically-1"></a><a class="docs-heading-anchor-permalink" href="#Insert/remove-nodes-programmatically" title="Permalink"></a></h2><p>Sometimes we want to remove or add a lot of nodes in an MTG. This is possible to do it programmatically using dedicated functions.</p><h2 id="Delete-nodes"><a class="docs-heading-anchor" href="#Delete-nodes">Delete nodes</a><a id="Delete-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Delete-nodes" title="Permalink"></a></h2><p>We can remove all nodes that meet specific conditions given by the usual node filters (see <a href="../2.descendants_ancestors_filters/#Filters">Filters</a> for more details). For example one could remove all nodes of scale 2 in an MTG, <em>i.e.</em> all nodes except the Plant in our example:</p><pre><code class="language-julia hljs">mtg_2 = deepcopy(mtg)

delete_nodes!(mtg_2, scale = 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
</code></pre><p>We can also remove nodes with more complex filters, for example all nodes with an index greater or equal to 1:</p><pre><code class="language-julia hljs">mtg_3 = deepcopy(mtg)

delete_nodes!(mtg_3, filter_fun = node -&gt; node_mtg(node).index &gt;= 1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   └─ + 3: Leaf
</code></pre><div class="admonition is-info" id="Note-b2a6740781f55547"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-b2a6740781f55547" title="Permalink"></a></header><div class="admonition-body"><p><a href="../../api/#MultiScaleTreeGraph.delete_nodes!-Tuple{Any}"><code>delete_nodes!</code></a> always returns the root node of the resulting MTG. If the old root was deleted and had one child, that child becomes the new root. If the old root had several children, the function returns an error. In practice, re-assign the result to keep the correct root reference after deletions.</p></div></div><p>As for <a href="../../api/#MultiScaleTreeGraph.delete_node!-Union{Tuple{Node{N, A}}, Tuple{A}, Tuple{N}} where {N&lt;:AbstractNodeMTG, A}"><code>delete_node!</code></a> (singular), by default <a href="../../api/#MultiScaleTreeGraph.delete_nodes!-Tuple{Any}"><code>delete_nodes!</code></a> (plural) uses <a href="../../api/#MultiScaleTreeGraph.new_child_link"><code>new_child_link</code></a> to re-link the children of the deleted nodes, but the user can provide a custom function. See the function details to learn more about it.</p><h2 id="Insert-nodes"><a class="docs-heading-anchor" href="#Insert-nodes">Insert nodes</a><a id="Insert-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Insert-nodes" title="Permalink"></a></h2><h3 id="Insert-nodes-at-position"><a class="docs-heading-anchor" href="#Insert-nodes-at-position">Insert nodes at position</a><a id="Insert-nodes-at-position-1"></a><a class="docs-heading-anchor-permalink" href="#Insert-nodes-at-position" title="Permalink"></a></h3><p>We can add new nodes in an MTG programmatically using:</p><ul><li><a href="../../api/#MultiScaleTreeGraph.insert_parents!"><code>insert_parents!</code></a>: add a new parent node to the filtered nodes</li><li><a href="../../api/#MultiScaleTreeGraph.insert_children!"><code>insert_children!</code></a>: add a new child node to the filtered nodes</li><li><a href="../../api/#MultiScaleTreeGraph.insert_siblings!"><code>insert_siblings!</code></a>: add a new sibling node to the filtered nodes</li><li><a href="../../api/#MultiScaleTreeGraph.insert_generations!"><code>insert_generations!</code></a>: add a new child node to the filtered nodes, but this new child is considered a whole new generation, meaning the previous children of the targeted nodes become the children of the new child node (<em>i.e.</em> a new generation).</li></ul><div class="admonition is-warning" id="Warning-744701c255484159"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-744701c255484159" title="Permalink"></a></header><div class="admonition-body"><p>Note the plural form for the name of the functions. The singular form does the same thing but only on the node we provide as input. The plural forms do the job for every filtered node in the MTG.</p></div></div><p>The functions insert new nodes based either on a template NodeMTG or a function that computes it. The attributes of the nodes are empty by default, be can also be provided by the user either as is, or as a function that computes them.</p><p>The id of the inserted node is automatically computed using <a href="../../api/#MultiScaleTreeGraph.new_id-Tuple{Int64}"><code>new_id</code></a>.</p><p>For example if we need to insert new Flower nodes as parents of each Leaf, we would do:</p><pre><code class="language-julia hljs">mtg_4 = deepcopy(mtg)
template = MutableNodeMTG(:+, :Flower, 0, 2)
insert_parents!(mtg_4, template, symbol = :Leaf)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ &lt; 4: Internode
   │  └─ + 5: Leaf
   └─ + 6: Flower
      └─ + 7: Flower
         └─ + 3: Leaf
</code></pre><p>Similarly, we can add a new child to leaves using <a href="../../api/#MultiScaleTreeGraph.insert_children!"><code>insert_children!</code></a>:</p><pre><code class="language-julia hljs">template = MutableNodeMTG(:/, :Leaflet, 0, 3)
insert_children!(mtg_4, template, symbol = :Leaf)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ &lt; 4: Internode
   │  └─ + 5: Leaf
   │     └─ / 8: Leaflet
   └─ + 6: Flower
      └─ + 7: Flower
         └─ + 3: Leaf
            └─ / 9: Leaflet
</code></pre><p>Usually, the flower is positioned as a sibling of the leaf though. To do so, we can use <a href="../../api/#MultiScaleTreeGraph.insert_siblings!"><code>insert_siblings!</code></a>:</p><pre><code class="language-julia hljs">mtg_5 = deepcopy(mtg)
template = MutableNodeMTG(:+, :Flower, 0, 2)
insert_siblings!(mtg_5, template, symbol = :Leaf)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ + 3: Leaf
   ├─ &lt; 4: Internode
   │  ├─ + 5: Leaf
   │  └─ + 7: Flower
   └─ + 6: Flower
</code></pre><h3 id="Compute-the-template-on-the-fly"><a class="docs-heading-anchor" href="#Compute-the-template-on-the-fly">Compute the template on the fly</a><a id="Compute-the-template-on-the-fly-1"></a><a class="docs-heading-anchor-permalink" href="#Compute-the-template-on-the-fly" title="Permalink"></a></h3><p>The template for the <code>NodeMTG</code> can also be computed on the fly for more complex designs:</p><pre><code class="language-julia hljs">insert_children!(
    mtg_5,
    node -&gt; if node_id(node) == 3 MutableNodeMTG(:/, :Spear, 0, 3) else MutableNodeMTG(:/, :Leaflet, 0, 3) end,
    symbol = :Leaf
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ + 3: Leaf
   │  └─ / 8: Spear
   ├─ &lt; 4: Internode
   │  ├─ + 5: Leaf
   │  │  └─ / 9: Leaflet
   │  └─ + 7: Flower
   └─ + 6: Flower
</code></pre><h3 id="Compute-attributes-on-the-fly"><a class="docs-heading-anchor" href="#Compute-attributes-on-the-fly">Compute attributes on the fly</a><a id="Compute-attributes-on-the-fly-1"></a><a class="docs-heading-anchor-permalink" href="#Compute-attributes-on-the-fly" title="Permalink"></a></h3><p>The same is true for the attributes. We can provide them as is:</p><pre><code class="language-julia hljs">insert_siblings!(
    mtg_5,
    MutableNodeMTG(:+, :Leaf, 0, 2),
    Dict{Symbol, Any}(:area =&gt; 0.1),
    symbol = :Leaf
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ + 3: Leaf
   │  └─ / 8: Spear
   ├─ &lt; 4: Internode
   │  ├─ + 5: Leaf
   │  │  └─ / 9: Leaflet
   │  ├─ + 7: Flower
   │  └─ + 11: Leaf
   ├─ + 6: Flower
   └─ + 10: Leaf
</code></pre><p>Or compute them based on the node on which we insert the new nodes. For example if we want the new node to take twice the values of the area of the node it is inserted on, we would do:</p><pre><code class="language-julia hljs">insert_siblings!(
    mtg_5,
    MutableNodeMTG(:+, :Leaf, 0, 2),
    node -&gt; node[:area] === nothing  ? nothing : Dict{Symbol, Any}(:area =&gt; node[:area] * 2),
    symbol = :Leaf
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Plant
└─ / 2: Internode
   ├─ + 3: Leaf
   │  └─ / 8: Spear
   ├─ &lt; 4: Internode
   │  ├─ + 5: Leaf
   │  │  └─ / 9: Leaflet
   │  ├─ + 7: Flower
   │  ├─ + 11: Leaf
   │  ├─ + 13: Leaf
   │  └─ + 14: Leaf
   ├─ + 6: Flower
   ├─ + 10: Leaf
   ├─ + 12: Leaf
   └─ + 15: Leaf
</code></pre><div class="admonition is-danger" id="Danger-3a1753474905d297"><header class="admonition-header">Danger<a class="admonition-anchor" href="#Danger-3a1753474905d297" title="Permalink"></a></header><div class="admonition-body"><p>The function used to compute the attributes must return data using the same structure as the one used for the other nodes attributes. In our example it returns a <code>Dict{Symbol, Any}</code>, but it can be different depending on your MTG. To know which structure you should use, use this command:</p><pre><code class="language-julia hljs">typeof(node_attributes(mtg))</code></pre></div></div><p>Let&#39;s see the results for the area of our leaves:</p><pre><code class="language-julia hljs">DataFrame(mtg_5, :area)</code></pre><div><div style = "float: left;"><span>15×8 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">tree</th><th style = "text-align: left;">id</th><th style = "text-align: left;">symbol</th><th style = "text-align: left;">scale</th><th style = "text-align: left;">index</th><th style = "text-align: left;">parent_id</th><th style = "text-align: left;">link</th><th style = "text-align: left;">area</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Union{Missing, String}" style = "text-align: left;">String?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Symbol}" style = "text-align: left;">Symbol?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Int64}" style = "text-align: left;">Int64?</th><th title = "Union{Missing, Symbol}" style = "text-align: left;">Symbol?</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">/ 1: Plant</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Plant</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "text-align: left;">/</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">└─ / 2: Internode</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: left;">/</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">   ├─ + 3: Leaf</td><td style = "text-align: right;">3</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">2</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.2</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">   │  └─ / 8: Spear</td><td style = "text-align: right;">8</td><td style = "text-align: left;">Spear</td><td style = "text-align: right;">3</td><td style = "text-align: right;">0</td><td style = "text-align: right;">3</td><td style = "text-align: left;">/</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">   ├─ &lt; 4: Internode</td><td style = "text-align: right;">4</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">2</td><td style = "text-align: left;">&lt;</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">   │  ├─ + 5: Leaf</td><td style = "text-align: right;">5</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">4</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.2</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">   │  │  └─ / 9: Leaflet</td><td style = "text-align: right;">9</td><td style = "text-align: left;">Leaflet</td><td style = "text-align: right;">3</td><td style = "text-align: right;">0</td><td style = "text-align: right;">5</td><td style = "text-align: left;">/</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">   │  ├─ + 7: Flower</td><td style = "text-align: right;">7</td><td style = "text-align: left;">Flower</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">4</td><td style = "text-align: left;">+</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">   │  ├─ + 11: Leaf</td><td style = "text-align: right;">11</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">4</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.1</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">   │  ├─ + 13: Leaf</td><td style = "text-align: right;">13</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">4</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.4</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: left;">   │  └─ + 14: Leaf</td><td style = "text-align: right;">14</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">4</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.2</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: left;">   ├─ + 6: Flower</td><td style = "text-align: right;">6</td><td style = "text-align: left;">Flower</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">2</td><td style = "text-align: left;">+</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: left;">   ├─ + 10: Leaf</td><td style = "text-align: right;">10</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">2</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.1</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: left;">   ├─ + 12: Leaf</td><td style = "text-align: right;">12</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">2</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.4</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: left;">   └─ + 15: Leaf</td><td style = "text-align: right;">15</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">2</td><td style = "text-align: left;">+</td><td style = "text-align: right;">0.2</td></tr></tbody></table></div><h3 id="Write-the-MTG"><a class="docs-heading-anchor" href="#Write-the-MTG">Write the MTG</a><a id="Write-the-MTG-1"></a><a class="docs-heading-anchor-permalink" href="#Write-the-MTG" title="Permalink"></a></h3><p>Finally, we can write our newly created MTG to disk using <a href="../../api/#MultiScaleTreeGraph.write_mtg-Tuple{Any, Any}"><code>write_mtg</code></a>. The header of the MTG file will be computed automatically based on the information in the MTG. If you want to pass your own header information you can use the corresponding arguments in the function, <em>e.g.</em> <code>classes</code>.</p><pre><code class="language- hljs">write_mtg(&quot;myMTG.mtg&quot;,mtg)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../5.plotting/">« Plotting</a><a class="docs-footer-nextpage" href="../7.performance_considerations/">Performance Considerations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 19 February 2026 06:32">Thursday 19 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
